# ğŸ—„ï¸ Agora í”„ë¡œì íŠ¸ - ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

**ì‘ì„±ì¼:** 2025-11-27  
**í”„ë¡œì íŠ¸:** Spring Boot + Flutter ë©”ì‹ ì € ì•±  
**ë°ì´í„°ë² ì´ìŠ¤:** PostgreSQL

---

## ğŸ“‹ ëª©ì°¨

1. [ì¸ì¦ & ì‚¬ìš©ì](#1-ì¸ì¦--ì‚¬ìš©ì)
2. [ì¹œêµ¬ ê´€ë¦¬](#2-ì¹œêµ¬-ê´€ë¦¬)
3. [ì±„íŒ…](#3-ì±„íŒ…)
4. [íŒ€ ê´€ë¦¬](#4-íŒ€-ê´€ë¦¬)
5. [íŒ€ ê¸°ëŠ¥](#5-íŒ€-ê¸°ëŠ¥)
6. [ì•Œë¦¼](#6-ì•Œë¦¼)
7. [íŒŒì¼](#7-íŒŒì¼)
8. [ë³´ì•ˆ](#8-ë³´ì•ˆ)
9. [ì„¤ì •](#9-ì„¤ì •)

---

## 1. ì¸ì¦ & ì‚¬ìš©ì

### 1.1 users (ì‚¬ìš©ì)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì‚¬ìš©ì ID |
| email | VARCHAR(100) | PRIMARY KEY | ì´ë©”ì¼ |
| profile_image | TEXT | | í”„ë¡œí•„ ì´ë¯¸ì§€ URL |
| bio | TEXT | | ìê¸°ì†Œê°œ |
| phone | VARCHAR(20) | | ì „í™”ë²ˆí˜¸ |
| birthday | DATE | | ìƒë…„ì›”ì¼ |

**ì¸ë±ìŠ¤:**
- `idx_users_email` ON (email)
- `idx_users_username` ON (username)
- `idx_users_phone` ON (phone)


## 2. ì¹œêµ¬ ê´€ë¦¬

### 2.1 friends (ì¹œêµ¬)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì¹œêµ¬ ê´€ê³„ ID |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| friend_id | BIGINT | NOT NULL, FK â†’ users(id) | ì¹œêµ¬ ID |
| is_favorite | BOOLEAN | NOT NULL, DEFAULT FALSE | ì¦ê²¨ì°¾ê¸° ì—¬ë¶€ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ì¹œêµ¬ ì¶”ê°€ ì‹œê°„ |

**ì œì•½ì¡°ê±´:**
- UNIQUE (user_id, friend_id)
- CHECK (user_id != friend_id)

**ì¸ë±ìŠ¤:**
- `idx_friends_user_id` ON (user_id)
- `idx_friends_friend_id` ON (friend_id)

---

### 2.2 friend_requests (ì¹œêµ¬ ìš”ì²­)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ìš”ì²­ ID |
| from_user_id | BIGINT | NOT NULL, FK â†’ users(id) | ìš”ì²­ ë³´ë‚¸ ì‚¬ìš©ì ID |
| to_user_id | BIGINT | NOT NULL, FK â†’ users(id) | ìš”ì²­ ë°›ì€ ì‚¬ìš©ì ID |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'PENDING' | ìƒíƒœ (PENDING, ACCEPTED, REJECTED) |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìš”ì²­ ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

**ì œì•½ì¡°ê±´:**
- UNIQUE (from_user_id, to_user_id)
- CHECK (from_user_id != to_user_id)

**ì¸ë±ìŠ¤:**
- `idx_friend_requests_to_user_id` ON (to_user_id)
- `idx_friend_requests_status` ON (status)

---

### 2.3 blocked_users (ì°¨ë‹¨ ì‚¬ìš©ì)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì°¨ë‹¨ ID |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì°¨ë‹¨í•œ ì‚¬ìš©ì ID |
| blocked_user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì°¨ë‹¨ëœ ì‚¬ìš©ì ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ì°¨ë‹¨ ì‹œê°„ |

**ì œì•½ì¡°ê±´:**
- UNIQUE (user_id, blocked_user_id)

**ì¸ë±ìŠ¤:**
- `idx_blocked_users_user_id` ON (user_id)

---

## 3. ì±„íŒ…

### 3.1 chats (ì±„íŒ…ë°©)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì±„íŒ…ë°© ID |
| type | VARCHAR(20) | NOT NULL | íƒ€ì… (DIRECT, GROUP) |
| name | VARCHAR(100) | | ê·¸ë£¹ ì±„íŒ…ë°© ì´ë¦„ |
| profile_image | TEXT | | ê·¸ë£¹ í”„ë¡œí•„ ì´ë¯¸ì§€ URL |
| read_count | BIGINT | NOT NULL, DEFAULT 1 | ë©”ì‹œì§€ ì½ì€ ì‚¬ìš©ì ìˆ˜
| read_enabled | BOOLEAN | NOT NULL, DEFAULT FALSE | ì½ìŒ í‘œì‹œ í™œì„±í™” ì—¬ë¶€
| created_by | BIGINT | FK â†’ users(id) | ìƒì„±ì ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_chats_type` ON (type)
- `idx_chats_created_by` ON (created_by)

---

### 3.2 chat_participants (ì±„íŒ… ì°¸ì—¬ì)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì°¸ì—¬ì ID |
| chat_id | BIGINT | NOT NULL, FK â†’ chats(id) | ì±„íŒ…ë°© ID |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| role | VARCHAR(20) | DEFAULT 'MEMBER' | ì—­í•  (ADMIN, MEMBER) |
| is_pinned | BOOLEAN | NOT NULL, DEFAULT FALSE | ì±„íŒ…ë°© ê³ ì • ì—¬ë¶€ |
| pinned_at | TIMESTAMP | NULL | ê³ ì •í•œ ì‹œê°„ (ì •ë ¬ìš©) |
| joined_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ì°¸ì—¬ ì‹œê°„ |

**ì œì•½ì¡°ê±´:**
- UNIQUE (chat_id, user_id)

**ì¸ë±ìŠ¤:**
- `idx_chat_participants_chat_id` ON (chat_id)
- `idx_chat_participants_user_id` ON (user_id)
- `idx_chat_participants_pinned` ON (user_id, is_pinned, pinned_at DESC)

---

### 3.3 messages (ë©”ì‹œì§€)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ë©”ì‹œì§€ ID |
| chat_id | BIGINT | NOT NULL, FK â†’ chats(id) | ì±„íŒ…ë°© ID |
| sender_id | BIGINT | NOT NULL, FK â†’ users(id) | ë°œì‹ ì ID |
| content | TEXT | | ë©”ì‹œì§€ ë‚´ìš© |
| type | VARCHAR(20) | NOT NULL, DEFAULT 'TEXT' | íƒ€ì… (TEXT, IMAGE, FILE, SYSTEM) |
| reply_to_id | BIGINT | FK â†’ messages(id) | ë‹µì¥ ëŒ€ìƒ ë©”ì‹œì§€ ID |
| is_deleted | BOOLEAN | NOT NULL, DEFAULT FALSE | ì‚­ì œ ì—¬ë¶€ |
| is_pinned | BOOLEAN | NOT NULL, DEFAULT FALSE | ë©”ì‹œì§€ ê³ ì • ì—¬ë¶€ |
| private_only_user_id | BIGINT | DEFAULT NULL | íŠ¹ì • ì‚¬ìš©ìì—ê²Œë§Œ ê³µê°œ ì—¬ë¶€ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_messages_chat_id` ON (chat_id)
- `idx_messages_sender_id` ON (sender_id)
- `idx_messages_created_at` ON (created_at DESC)

---

### 3.4 message_attachments (ë©”ì‹œì§€ ì²¨ë¶€íŒŒì¼)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì²¨ë¶€ ID |
| message_id | BIGINT | NOT NULL, FK â†’ messages(id) | ë©”ì‹œì§€ ID |
| file_id | BIGINT | NOT NULL, FK â†’ files(id) | íŒŒì¼ ID |
| order_index | INTEGER | NOT NULL, DEFAULT 0 | ì²¨ë¶€ ìˆœì„œ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |

**ì œì•½ì¡°ê±´:**
- UNIQUE (message_id, file_id)

**ì¸ë±ìŠ¤:**
- `idx_message_attachments_message_id` ON (message_id)
- `idx_message_attachments_file_id` ON (file_id)

---

### 3.5 message_read_status (ë©”ì‹œì§€ ì½ìŒ ìƒíƒœ)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì½ìŒ ìƒíƒœ ID |
| message_id | BIGINT | NOT NULL, FK â†’ messages(id) | ë©”ì‹œì§€ ID |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |

**ì œì•½ì¡°ê±´:**
- UNIQUE (message_id, user_id)

**ì¸ë±ìŠ¤:**
- `idx_message_read_status_message_id` ON (message_id)
- `idx_message_read_status_user_id` ON (user_id)

---

### 3.6 chat_folders (ì±„íŒ… í´ë”)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | í´ë” ID |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| name | VARCHAR(100) | NOT NULL | í´ë”ëª… |
| order_index | INTEGER | NOT NULL, DEFAULT 0 | ì •ë ¬ ìˆœì„œ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_chat_folders_user_id` ON (user_id)

---

### 3.7 chat_folder_items (ì±„íŒ… í´ë” ì•„ì´í…œ)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì•„ì´í…œ ID |
| folder_id | BIGINT | NOT NULL, FK â†’ chat_folders(id) | í´ë” ID |
| chat_id | BIGINT | NOT NULL, FK â†’ chats(id) | ì±„íŒ…ë°© ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ì¶”ê°€ ì‹œê°„ |

**ì œì•½ì¡°ê±´:**
- UNIQUE (folder_id, chat_id)

**ì¸ë±ìŠ¤:**
- `idx_chat_folder_items_folder_id` ON (folder_id)
- `idx_chat_folder_items_chat_id` ON (chat_id)

---

## 4. íŒ€ ê´€ë¦¬

### 4.1 teams (íŒ€)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | íŒ€ ID |
| name | VARCHAR(100) | NOT NULL | íŒ€ëª… |
| description | TEXT | | íŒ€ ì„¤ëª… |
| profile_image | TEXT | | íŒ€ í”„ë¡œí•„ ì´ë¯¸ì§€ URL |
| is_main | BOOLEAN | NOT NULL, DEFAULT FALSE | ë©”ì¸ íŒ€ ì—¬ë¶€ |
| created_by | BIGINT | NOT NULL, FK â†’ users(id) | ìƒì„±ì ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_teams_created_by` ON (created_by)

---

### 4.2 team_members (íŒ€ì›)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | íŒ€ì› ID |
| team_id | BIGINT | NOT NULL, FK â†’ teams(id) | íŒ€ ID |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| role_id | BIGINT | FK â†’ team_roles(id) | ì—­í•  ID |
| position_id | BIGINT | FK â†’ team_positions(id) | ì§ì±… ID |
| joined_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ê°€ì… ì‹œê°„ |

**ì œì•½ì¡°ê±´:**
- UNIQUE (team_id, user_id)

**ì¸ë±ìŠ¤:**
- `idx_team_members_team_id` ON (team_id)
- `idx_team_members_user_id` ON (user_id)

---

### 4.3 team_roles (íŒ€ ì—­í• )

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì—­í•  ID |
| team_id | BIGINT | NOT NULL, FK â†’ teams(id) | íŒ€ ID |
| name | VARCHAR(50) | NOT NULL | ì—­í• ëª… (OWNER, ADMIN, MEMBER) |
| permissions | TEXT | | ê¶Œí•œ ëª©ë¡ (JSON) |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |

**ì œì•½ì¡°ê±´:**
- UNIQUE (team_id, name)

**ì¸ë±ìŠ¤:**
- `idx_team_roles_team_id` ON (team_id)

---

## 5. íŒ€ ê¸°ëŠ¥

### 5.1 notices (ê³µì§€ì‚¬í•­)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ê³µì§€ì‚¬í•­ ID |
| team_id | BIGINT | NOT NULL, FK â†’ teams(id) | íŒ€ ID |
| author_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‘ì„±ì ID |
| title | VARCHAR(200) | NOT NULL | ì œëª© |
| content | TEXT | NOT NULL | ë‚´ìš© |
| is_pinned | BOOLEAN | NOT NULL, DEFAULT FALSE | ìƒë‹¨ ê³ ì • ì—¬ë¶€ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_notices_team_id` ON (team_id)
- `idx_notices_created_at` ON (created_at DESC)

---

### 5.2 todos (í•  ì¼)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | í•  ì¼ ID |
| team_id | BIGINT | NOT NULL, FK â†’ teams(id) | íŒ€ ID |
| created_by | BIGINT | NOT NULL, FK â†’ users(id) | ìƒì„±ì ID |
| assigned_to | BIGINT | FK â†’ users(id) | ë‹´ë‹¹ì ID |
| title | VARCHAR(200) | NOT NULL | ì œëª© |
| description | TEXT | | ì„¤ëª… |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'TODO' | ìƒíƒœ (TODO, IN_PROGRESS, DONE) |
| priority | VARCHAR(20) | DEFAULT 'MEDIUM' | ìš°ì„ ìˆœìœ„ (LOW, MEDIUM, HIGH) |
| due_date | TIMESTAMP | | ë§ˆê°ì¼ |
| completed_at | TIMESTAMP | | ì™„ë£Œ ì‹œê°„ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_todos_team_id` ON (team_id)
- `idx_todos_assigned_to` ON (assigned_to)
- `idx_todos_status` ON (status)

---

### 5.3 events (ì¼ì •)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì¼ì • ID |
| team_id | BIGINT | NOT NULL, FK â†’ teams(id) | íŒ€ ID |
| created_by | BIGINT | NOT NULL, FK â†’ users(id) | ìƒì„±ì ID |
| title | VARCHAR(200) | NOT NULL | ì œëª© |
| description | TEXT | | ì„¤ëª… |
| location | VARCHAR(200) | | ì¥ì†Œ |
| start_time | TIMESTAMP | NOT NULL | ì‹œì‘ ì‹œê°„ |
| end_time | TIMESTAMP | NOT NULL | ì¢…ë£Œ ì‹œê°„ |
| is_all_day | BOOLEAN | NOT NULL, DEFAULT FALSE | ì¢…ì¼ ì¼ì • ì—¬ë¶€ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_events_team_id` ON (team_id)
- `idx_events_start_time` ON (start_time)

---

## 6. ì•Œë¦¼

### 6.1 notifications (ì•Œë¦¼)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì•Œë¦¼ ID |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| type | VARCHAR(50) | NOT NULL | ì•Œë¦¼ íƒ€ì… (MESSAGE, FRIEND_REQUEST, TEAM_INVITE ë“±) |
| title | VARCHAR(200) | NOT NULL | ì œëª© |
| content | TEXT | | ë‚´ìš© |
| related_id | BIGINT | | ê´€ë ¨ ì—”í‹°í‹° ID |
| related_type | VARCHAR(50) | | ê´€ë ¨ ì—”í‹°í‹° íƒ€ì… |
| is_read | BOOLEAN | NOT NULL, DEFAULT FALSE | ì½ìŒ ì—¬ë¶€ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_notifications_user_id` ON (user_id)
- `idx_notifications_is_read` ON (is_read)
- `idx_notifications_created_at` ON (created_at DESC)

---

### 6.2 fcm_tokens (FCM í† í°)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | í† í° ID |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| token | VARCHAR(500) | UNIQUE, NOT NULL | FCM í† í° |
| device_type | VARCHAR(20) | NOT NULL | ë””ë°”ì´ìŠ¤ íƒ€ì… (ANDROID, IOS, WEB) |
| device_id | VARCHAR(100) | | ë””ë°”ì´ìŠ¤ ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_fcm_tokens_user_id` ON (user_id)
- `idx_fcm_tokens_token` ON (token)

---

## 7. íŒŒì¼

### 7.1 files (íŒŒì¼)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | íŒŒì¼ ID |
| uploaded_by | BIGINT | NOT NULL, FK â†’ users(id) | ì—…ë¡œë“œí•œ ì‚¬ìš©ì ID |
| file_name | VARCHAR(255) | NOT NULL | íŒŒì¼ëª… |
| original_name | VARCHAR(255) | NOT NULL | ì›ë³¸ íŒŒì¼ëª… |
| file_path | TEXT | NOT NULL | íŒŒì¼ ê²½ë¡œ |
| file_url | TEXT | NOT NULL | íŒŒì¼ URL |
| thumbnail_url | TEXT | | ì¸ë„¤ì¼ URL (ì´ë¯¸ì§€ì¸ ê²½ìš°) |
| file_size | BIGINT | NOT NULL | íŒŒì¼ í¬ê¸° (bytes) |
| mime_type | VARCHAR(100) | NOT NULL | MIME íƒ€ì… |
| file_type | VARCHAR(20) | NOT NULL | íŒŒì¼ íƒ€ì… (IMAGE, VIDEO, DOCUMENT, OTHER) |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ì—…ë¡œë“œ ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_files_uploaded_by` ON (uploaded_by)
- `idx_files_file_type` ON (file_type)

---

### 7.2 file_metadata (íŒŒì¼ ë©”íƒ€ë°ì´í„°)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ë©”íƒ€ë°ì´í„° ID |
| file_id | BIGINT | NOT NULL, FK â†’ files(id) | íŒŒì¼ ID |
| width | INTEGER | | ì´ë¯¸ì§€ ë„ˆë¹„ |
| height | INTEGER | | ì´ë¯¸ì§€ ë†’ì´ |
| duration | INTEGER | | ë¹„ë””ì˜¤ ê¸¸ì´ (ì´ˆ) |
| metadata | TEXT | | ì¶”ê°€ ë©”íƒ€ë°ì´í„° (JSON) |

**ì œì•½ì¡°ê±´:**
- UNIQUE (file_id)

---

## 8. ë³´ì•ˆ

### 8.1 user_sessions (ì‚¬ìš©ì ì„¸ì…˜)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | VARCHAR(255) | PRIMARY KEY | ì„¸ì…˜ ID (UUID) |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| device_type | VARCHAR(50) | | ë””ë°”ì´ìŠ¤ íƒ€ì… |
| device_name | VARCHAR(100) | | ë””ë°”ì´ìŠ¤ ì´ë¦„ |
| ip_address | VARCHAR(50) | | IP ì£¼ì†Œ |
| location | VARCHAR(100) | | ìœ„ì¹˜ |
| user_agent | TEXT | | User Agent |
| last_active_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_user_sessions_user_id` ON (user_id)
- `idx_user_sessions_last_active_at` ON (last_active_at)

---

### 8.2 two_factor_auth (2ë‹¨ê³„ ì¸ì¦)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | 2FA ID |
| user_id | BIGINT | UNIQUE, NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| secret_key | VARCHAR(255) | NOT NULL | TOTP ì‹œí¬ë¦¿ í‚¤ |
| backup_codes | TEXT | | ë°±ì—… ì½”ë“œ (JSON ë°°ì—´) |
| enabled_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | í™œì„±í™” ì‹œê°„ |

---

### 8.3 login_history (ë¡œê·¸ì¸ ê¸°ë¡)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ê¸°ë¡ ID |
| user_id | BIGINT | NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| ip_address | VARCHAR(50) | | IP ì£¼ì†Œ |
| location | VARCHAR(100) | | ìœ„ì¹˜ |
| device_type | VARCHAR(50) | | ë””ë°”ì´ìŠ¤ íƒ€ì… |
| user_agent | TEXT | | User Agent |
| success | BOOLEAN | NOT NULL | ì„±ê³µ ì—¬ë¶€ |
| failure_reason | VARCHAR(100) | | ì‹¤íŒ¨ ì‚¬ìœ  |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ë¡œê·¸ì¸ ì‹œë„ ì‹œê°„ |

**ì¸ë±ìŠ¤:**
- `idx_login_history_user_id` ON (user_id)
- `idx_login_history_created_at` ON (created_at DESC)

---

## 9. ì„¤ì •

### 9.1 user_settings (ì‚¬ìš©ì ì„¤ì •)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------|----------|------|
| id | BIGSERIAL | PRIMARY KEY | ì„¤ì • ID |
| user_id | BIGINT | UNIQUE, NOT NULL, FK â†’ users(id) | ì‚¬ìš©ì ID |
| push_enabled | BOOLEAN | NOT NULL, DEFAULT TRUE | í‘¸ì‹œ ì•Œë¦¼ í™œì„±í™” |
| message_notification | BOOLEAN | NOT NULL, DEFAULT TRUE | ë©”ì‹œì§€ ì•Œë¦¼ |
| friend_request_notification | BOOLEAN | NOT NULL, DEFAULT TRUE | ì¹œêµ¬ ìš”ì²­ ì•Œë¦¼ |
| team_notification | BOOLEAN | NOT NULL, DEFAULT TRUE | íŒ€ ì•Œë¦¼ |
| notice_notification | BOOLEAN | NOT NULL, DEFAULT TRUE | ê³µì§€ì‚¬í•­ ì•Œë¦¼ |
| sound_enabled | BOOLEAN | NOT NULL, DEFAULT TRUE | ì•Œë¦¼ ì†Œë¦¬ |
| vibration_enabled | BOOLEAN | NOT NULL, DEFAULT TRUE | ì§„ë™ |
| do_not_disturb_start | TIME | | ë°©í•´ ê¸ˆì§€ ì‹œì‘ ì‹œê°„ |
| do_not_disturb_end | TIME | | ë°©í•´ ê¸ˆì§€ ì¢…ë£Œ ì‹œê°„ |
| profile_visibility | VARCHAR(20) | DEFAULT 'FRIENDS' | í”„ë¡œí•„ ê³µê°œ ë²”ìœ„ (PUBLIC, FRIENDS, NONE) |
| phone_visibility | VARCHAR(20) | DEFAULT 'NONE' | ì „í™”ë²ˆí˜¸ ê³µê°œ ë²”ìœ„ |
| birthday_visibility | VARCHAR(20) | DEFAULT 'FRIENDS' | ìƒì¼ ê³µê°œ ë²”ìœ„ |
| allow_friend_requests | BOOLEAN | NOT NULL, DEFAULT TRUE | ì¹œêµ¬ ìš”ì²­ í—ˆìš© |
| allow_group_invites | BOOLEAN | NOT NULL, DEFAULT TRUE | ê·¸ë£¹ ì´ˆëŒ€ í—ˆìš© |
| show_online_status | BOOLEAN | NOT NULL, DEFAULT TRUE | ì˜¨ë¼ì¸ ìƒíƒœ í‘œì‹œ |
| login_notification | BOOLEAN | NOT NULL, DEFAULT TRUE | ë¡œê·¸ì¸ ì•Œë¦¼ |
| session_timeout | INTEGER | DEFAULT 30 | ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ (ë¶„) |
| birthday_reminder_enabled | BOOLEAN | NOT NULL, DEFAULT TRUE | ìƒì¼ ì•Œë¦¼ í™œì„±í™” |
| birthday_reminder_days_before | INTEGER | DEFAULT 3 | ìƒì¼ ë©°ì¹  ì „ ì•Œë¦¼ |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìƒì„± ì‹œê°„ |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | ìˆ˜ì • ì‹œê°„ |

---

## ğŸ“Š í…Œì´ë¸” ìš”ì•½

| ì¹´í…Œê³ ë¦¬ | í…Œì´ë¸” ìˆ˜ | í…Œì´ë¸” ëª©ë¡ |
|----------|-----------|-------------|
| ì¸ì¦ & ì‚¬ìš©ì | 5 | users, refresh_tokens, email_verification_tokens, password_reset_tokens, sms_verification_codes |
| ì¹œêµ¬ ê´€ë¦¬ | 3 | friends, friend_requests, blocked_users |
| ì±„íŒ… | 7 | chats, chat_participants, messages, message_attachments, message_read_status, chat_folders, chat_folder_items |
| íŒ€ ê´€ë¦¬ | 5 | teams, team_members, team_roles, team_positions, org_chart_nodes |
| íŒ€ ê¸°ëŠ¥ | 3 | notices, todos, events |
| ì•Œë¦¼ | 2 | notifications, fcm_tokens |
| íŒŒì¼ | 2 | files, file_metadata |
| ë³´ì•ˆ | 3 | user_sessions, two_factor_auth, login_history |
| ì„¤ì • | 1 | user_settings |

**ì´ í…Œì´ë¸” ìˆ˜:** 31ê°œ

---

## ğŸ”— ì£¼ìš” ê´€ê³„ë„

```mermaid
erDiagram
    users ||--o{ refresh_tokens : has
    users ||--o{ friends : has
    users ||--o{ friend_requests : sends
    users ||--o{ chat_participants : participates
    users ||--o{ messages : sends
    users ||--o{ team_members : belongs
    users ||--o{ notifications : receives
    
    chats ||--o{ chat_participants : has
    chats ||--o{ messages : contains
    
    teams ||--o{ team_members : has
    teams ||--o{ team_roles : defines
    teams ||--o{ notices : has
    teams ||--o{ todos : has
    teams ||--o{ events : has
    
    messages ||--o{ message_read_status : tracked_by
    messages ||--o{ message_attachments : has
    message_attachments }o--|| files : references
```

---

**ì‘ì„±ì:** Antigravity AI Assistant  
**ìµœì¢… ìˆ˜ì •:** 2025-11-27  
**ë²„ì „:** 1.0
